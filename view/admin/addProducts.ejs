<!DOCTYPE html>
<html lang="en" class="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Forms - Admin One Tailwind CSS Admin Dashboard</title>

  <!-- Tailwind is included -->
  <link rel="stylesheet" href="/public/adminAssets/css/main.css?v=1628755089081">
  <link rel="stylesheet" href="/public/adminAssets/css/main.css">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#00b4b6" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"></script>
  
    <meta name="description" content="Admin One - free Tailwind dashboard">

  <meta property="og:url" content="https://justboil.github.io/admin-one-tailwind/">
  <meta property="og:site_name" content="JustBoil.me">
  <meta property="og:title" content="Admin One HTML">
  <meta property="og:description" content="Admin One - free Tailwind dashboard">
  <meta property="og:image" content="https://justboil.me/images/one-tailwind/repository-preview-hi-res.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1920">
  <meta property="og:image:height" content="960">

  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Admin One HTML">
  <meta property="twitter:description" content="Admin One - free Tailwind dashboard">
  <meta property="twitter:image:src" content="https://justboil.me/images/one-tailwind/repository-preview-hi-res.png">
  <meta property="twitter:image:width" content="1920">
  <meta property="twitter:image:height" content="960">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130795909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-130795909-1');
  </script>
  <style>
    .flex-container {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
    }

    .preview-image {
      max-width: 100px;
      max-height: 100px;
      margin-right: 10px;
    }

    .cropper-controls {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0;
    z-index: 1;
}
  </style>

</head>

<body>




  <aside class="aside is-placed-left is-expanded">
    <div class="aside-tools">
      <div>
        STREAK-X<b class="font-black">FRAMES</b>
      </div>
    </div>
    <div class="menu is-menu-main">
      <p class="menu-label">General</p>
      <ul class="menu-list">
        <li class="--set-active-tables-html">
          <a href="/admin/customers">
            <span class="icon"><i class="mdi mdi-account-group"></i></span>
            <span class="menu-item-label">Customers</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/categories">
            <span class="icon"><i class="mdi mdi-folder-outline"></i></span>
            <span class="menu-item-label">Categories</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/offer">
            <span class="icon"><i class="mdi mdi-tag"></i></span>
            <span class="menu-item-label">Offer</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/coupon">
            <span class="icon"><i class="mdi mdi-ticket-percent"></i></span>
            <span class="menu-item-label">Coupons</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/products">
            <span class="icon"><i class="mdi mdi-package-variant-closed"></i></span>
            <span class="menu-item-label">Products</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/orders">
            <span class="icon"><i class="mdi mdi-cart-outline"></i></span>
            <span class="menu-item-label">Orders</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/sales">
            <span class="icon"><i class="mdi mdi-chart-line"></i>
            </span>
            <span class="menu-item-label">Sales</span>
          </a>
        </li>
        <li>
          <a href="/admin/adminLogout">
            <span class="icon"><i class="mdi mdi-lock"></i></span>
            <span class="menu-item-label">Logout</span>
          </a>
        </li>
    </div>
  </aside>

  <section class="is-title-bar">
    <div class="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0">
      <ul>
        <li>Products</li>
        <li>Add Products</li>
      </ul>
    </div>
  </section>



  <section class="section main-section">
    <div class="card mb-6">
      <header class="card-header">
        <p class="card-header-title">
          <span class="icon"><i class="mdi mdi-ballot"></i></span>
          Add Product
        </p>
      </header>
      <div class="card-content">
        <form id="addForm" method="post" action="/admin/addProduct" onsubmit="return validateForm()" enctype="multipart/form-data">
          <div class="field">
            <label class="label">Product Name</label>
            <div class="control icons-left">
              <input class="input" type="text" id="name" name="name" placeholder="Product Name" required>
              <span class="icon left"><i class="mdi mdi-account"></i></span>
              <span id="nameError" class="text-danger"></span>
            </div>
          </div>
          <div class="field">
            <label class="label">Description</label>
            <div class="control">
              <textarea class="textarea" id="description" name="description" placeholder="Product Description"
                required></textarea>
            </div>
            <span id="descriptionError" class="text-danger"></span>
          </div>
          <div class="field">
            <label class="label">Category</label>
            <div class="control">
              <div class="select">
                <select name="category" required>
                  <% if(categories.length>0){ %>
                    <option value="" disabled selected hidden>
                      Choose a category
                    </option>

                    <% categories.forEach((item)=>{ %>

                      <option value="<%= item._id %>">
                        <%= item.categoryName %>
                      </option>
                      <% })}else{ %>
                        <option value="" disabled selected hidden>
                          No categories found
                        </option>
                        <% } %>
                </select>
              </div>
            </div>
          </div>
          <div class="field">
            <label class="label">Price</label>
            <div class="control icons-left">
              <input class="input" type="number" id="price" name="price" placeholder="Price" required>
              <span class="icon left"><i class="mdi mdi-currency-usd"></i></span>
              <span id="priceError" class="text-danger"></span>
            </div>
          </div>
          <div class="field">
            <label class="label">Quantity</label>
            <div class="control icons-left">
              <input class="input" type="number" id="quantity" name="quantity" placeholder="Quantity" required>
              <span class="icon left"><i class="mdi mdi-numeric"></i></span>
              <span id="quantityError"></span>
            </div>
          </div>
          <div class="field">
            <label class="label">Product Images</label>
            <div class="control">
                <input type="file" id="product-images" name="product-images" multiple required onchange="previewImages(event)">
            </div>
        
            <div class="selected-images">
              <label class="label">Selected Images:</label>
              <div id="image-carousel" class="carousel slide">
                  <div class="carousel-inner" id="image-carousel-inner"></div>
                  <button class="carousel-control-prev" type="button" data-bs-target="#image-carousel" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next" type="button" data-bs-target="#image-carousel" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Next</span>
                  </button>
              </div>
              <div id="crop-buttons-container"></div>
          </div>
      </div>
          <hr>
          <div class="field grouped">
            <div class="control">
              <button type="submit" id="submitAddProduct" class="button green">
                Add Product
              </button>
            </div>
            <div class="control">
              <button type="reset" class="button red">
                Reset
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>







      <script type="text/javascript" src="/public/adminAssets/js/main.min.js?v=1628755089081"></script>
      <noscript><img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=658339141622648&ev=PageView&noscript=1" /></noscript>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.9.95/css/materialdesignicons.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script>

    function validateForm() {

      const name = document.getElementById("name").value.trim()
      const description = document.getElementById("description").value.trim()
      const price = document.getElementById("price").value.trim()
      const quantity = document.getElementById('quantity').value.trim()


      console.log("name :", name, "description :", description, "quantity :", quantity, "price :", price);
      let isValid = true;
      //===============NAME ERROR====================================
      if (name === "" || name.match(/^\s+$/)) {
        const nameError = document.getElementById("nameError");
        nameError.textContent = "Please enter a valid name!";
        isValid = false;
      } else if (/\d/.test(name)) {
        const nameError = document.getElementById("nameError");
        nameError.textContent = "Name should not contain numbers.";
        isValid = false;
      } else {
        document.getElementById("nameError").textContent = "";
      }
      //==============================description ERROR======================= 
      if (description === "") {
        const descriptionError = document.getElementById("descriptionError");
        descriptionError.textContent = "please add description";
        isValid = false;
      } else {
        document.getElementById("descriptionError").textContent = "";
      }
      //===================quantity ERRORR=========================

      if (quantity === "") {
        const quantityError = document.getElementById("quantityError")
        quantityError.textContent = "Please enter a quantity value";
        isValid = false;
      } else if (Number(quantity) <= 0) {
        const quantityError = document.getElementById("quantityError");
        quantityError.textContent = "quantity cannot be negative value or zero!";
        isValid = false;
      } else if (quantity.toString().startsWith("0")) {
        const quantityError = document.getElementById("quantityError");
        quantityError.textContent = "quantity donot start with zero";
        isValid = false;
      } else {
        document.getElementById("quantityError").textContent = "";
      }
      //================price ERROR============================
      if (price === "") {
        const priceError = document.getElementById("priceError")
        priceError.textContent = "Please enter a criteria value";
        isValid = false;
      } else if (Number(price) < 0) {
        const priceError = document.getElementById("priceError");
        priceError.textContent = "price cannot be negative value!";
        isValid = false;
      } else if (price.toString().startsWith("0")) {
        const priceError = document.getElementById("priceError");
        priceError.textContent = "price value should not start with 0 ";
        isValid = false;
      } else {
        document.getElementById("priceError").textContent = "";
      }

      if (!isValid) {
        return false
      }
      return isValid;
    }

 

    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("addForm");
      console.log("current url :", window.location.href);
      form.addEventListener("submit", function (event) {
        event.preventDefault();

        const isValid = validateForm();
        if (isValid) {
          form.submit();
        }
      });
    });
    function previewImages(event) {
    const carouselInner = document.getElementById('image-carousel-inner');
    carouselInner.innerHTML = ''; 

    const files = event.target.files;
    const cropButtonsContainer = document.getElementById('crop-buttons-container');
    cropButtonsContainer.innerHTML = ''; 

    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        if (file.type.match('image.*')) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const item = document.createElement('div');
                item.classList.add('carousel-item');
                if (i === 0) {
                    item.classList.add('active');
                }
                const img = document.createElement('img');
                img.onload = function() {
                    if (i === 0) {
                        const cropButton = createCropButton(img);
                        cropButtonsContainer.appendChild(cropButton);
                    }
                };
                img.src = e.target.result;
                img.classList.add('d-block', 'w-100');
                item.appendChild(img);

                carouselInner.appendChild(item);
            };
            reader.readAsDataURL(file);
        }
    }
    const carousel = new bootstrap.Carousel(document.getElementById('image-carousel'));
}

function createCropButton(img) {
    const cropButton = document.createElement('button');
    cropButton.classList.add('crop-button', 'btn', 'btn-primary', 'mt-2');
    cropButton.innerText = 'Crop Image';
    cropButton.addEventListener('click', function(event) {
        event.preventDefault();
        showConfirmModal(img); 
    });
    return cropButton;
}


function showConfirmModal(img) {
    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
    const confirmButton = document.getElementById('confirmCropButton');
    confirmButton.onclick = function() {
        modal.hide(); 
        cropImage(img); 
    };
    modal.show(); 
}


function cropImage(imageElement) {
    console.log("image element :", imageElement);
    
    const cropper = new Cropper(imageElement, {
        aspectRatio: 1,
        crop(event) {
           
            console.log('Crop area changed:', event.detail);
                   },
    });

    cropper.on('crop', () => {
        const croppedImageData = cropper.getCroppedCanvas().toDataURL('image/jpeg');

        fetch('/cropImage', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ imageData: croppedImageData }),
        })
        .then(response => {
        })
        .catch(error => {
            console.error('Error cropping image:', error);
        });
    });
}




  </script>
</body>

</html>