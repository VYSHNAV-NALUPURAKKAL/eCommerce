<!DOCTYPE html>
<html lang="en" class="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tables - Admin One Tailwind CSS Admin Dashboard</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- Tailwind is included -->
  <link rel="stylesheet" href="/public/adminAssets/css/main.css?v=1628755089081">


  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#00b4b6" />

  <meta name="description" content="Admin One - free Tailwind dashboard">

  <meta property="og:url" content="https://justboil.github.io/admin-one-tailwind/">
  <meta property="og:site_name" content="JustBoil.me">
  <meta property="og:title" content="Admin One HTML">
  <meta property="og:description" content="Admin One - free Tailwind dashboard">
  <meta property="og:image" content="https://justboil.me/images/one-tailwind/repository-preview-hi-res.png">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1920">
  <meta property="og:image:height" content="960">

  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Admin One HTML">
  <meta property="twitter:description" content="Admin One - free Tailwind dashboard">
  <meta property="twitter:image:src" content="https://justboil.me/images/one-tailwind/repository-preview-hi-res.png">
  <meta property="twitter:image:width" content="1920">
  <meta property="twitter:image:height" content="960">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130795909-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-130795909-1');
  </script>

</head>

<body>


  <aside class="aside is-placed-left is-expanded">
    <div class="aside-tools">
      <div>
        STREAK-X <b class="font-black">FRAMES</b>
      </div>
    </div>
    <div class="menu is-menu-main">
      <p class="menu-label">General</p>
      <ul class="menu-list">
        <li class="--set-active-tables-html">
          <a href="/admin">
            <span class="icon"><i class="mdi mdi-desktop-mac"></i></span>
            <span class="menu-item-label">Dashboard</span>
          </a>
        </li>
      </ul>
      <p class="menu-label">Examples</p>
      <ul class="menu-list">
        <li class="--set-active-tables-html">
          <a href="/admin/customers">
            <span class="icon"><i class="mdi mdi-account-group"></i></span>
            <span class="menu-item-label">Customers</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/categories">
            <span class="icon"><i class="mdi mdi-folder-outline"></i></span>
            <span class="menu-item-label">Categories</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/offer">
            <span class="icon"><i class="mdi mdi-tag"></i></span>
            <span class="menu-item-label">Offer</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/coupon">
            <span class="icon"><i class="mdi mdi-ticket-percent"></i></span>
            <span class="menu-item-label">Coupons</span>
          </a>
        </li>
        <li class="active">
          <a href="/admin/products">
            <span class="icon"><i class="mdi mdi-package-variant-closed"></i></span>
            <span class="menu-item-label">Products</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/orders">
            <span class="icon"><i class="mdi mdi-cart-outline"></i></span>
            <span class="menu-item-label">Orders</span>
          </a>
        </li>
        <li class="--set-active-tables-html">
          <a href="/admin/sales">
            <span class="icon"><i class="mdi mdi-chart-line"></i>
            </span>
            <span class="menu-item-label">Sales</span>
          </a>
        </li>
        <li>
          <a href="/admin/adminLogout">
            <span class="icon"><i class="mdi mdi-lock"></i></span>
            <span class="menu-item-label">Logout</span>
          </a>
        </li>
    </div>
  </aside>

  <section class="is-title-bar">
    <div class="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0">
      <ul>
        <li>Admin</li>
        <li>Products</li>
      </ul>
    </div>
  </section>
  <section class="section main-section">
    <div class="container-fluid">
      <div class="row justify-content-center mb-3">
        <div class="col-md-7">
          <!-- Add Product Button -->
          <a href="/admin/addProduct" class="btn btn-primary">Add Product</a>
          <!-- End of Add Product Button -->
          <form class="search-container d-flex p-0" action="/admin/addProduct" method="get">
          </form>
        </div>
      </div>
      <h2 class="my-3">Products</h2>
      <div class="row">
        <div class="col-12">
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="thead-dark">
                <tr>
                  <th scope="col">Image</th>
                  <th scope="col">Name</th>
                  <th scope="col">Category</th>
                  <th scope="col">Price</th>
                  <th scope="col">Offer</th>
                  <th scope="col">applyOffer</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="productContainer">

                <% if (locals.products.length> 0) {
                  products.forEach((item,i) => { %>
                  <%console.log('iteeeeeem:',item)%>
                    <tr>
                      <td class="product-img">
                        <div class="image-container">
                          <% if (item.images.length> 0) { %>
                            <img src="/public/adminAssets/product-images/<%= item.images[0] %>" alt="Product Image"
                              class="img-thumbnail" />
                            <% } else { %>
                              <span class="no-image">No image available</span>
                              <% } %>
                        </div>
                      </td>
                      <td class="product-name">
                        <%= item.name %>
                      </td>
                      <td>
                        <span class="badge bg-primary">
                          <%= item.category.categoryName%>
                        </span>
                      </td>
                      <td class="product-price">
                        <% if (!item.offer) {%>
                          <h4 class="text-danger">&#8377; <%= item.price %>
                          </h4>
                          <%}else if(item.category.offer) { %>
                            <h4 class="text-danger"><del>₹<%= item.price %></del><br>₹
                              <%=item.discountedPrice %>
                            </h4>
                            <%}else { %>
                              <h4 class="text-danger"><del>₹<%= item.price %></del><br>₹
                                <%=item.discountedPrice %>
                              </h4>
                              <% } %>
                      </td>
                      <td>
                        <% if(item.category.offer) {%>
                          <p class="badge rounded-pill alert-success text-success">
                            <%=item.category.offer.discountAmount %>% offer
                          </p>
                          <%}else if(item.offer) {%>
                            <p class="badge rounded-pill alert-success text-success">
                              <%= item.offer.discountAmount%>% offer
                            </p>
                            <%}else{%>
                              N/A
                              <%}%>
                      </td>
                      <td class="justify-content-center text-center">
                        <b>
                          <%console.log("item.category.offer :",item.category.offer)%>
                          <%if (item.category.offer){%>
                            <div>
                              <p class="badge alert-dark text-success">
                                category offer applied
                              </p>
                            </div>
                            <%}else if(item.offer){%>
                              <div class="mb-2">
                                <p class="badge  alert-dark text-success">
                                  Product offer applied
                                </p>
                              </div>
                              <a><button type="button" class="removeoffer "
                                  onclick="removeoffer('<%=i%>')">Remove</button></a>
                              <input type="hidden" value='<%= item._id %>' id="hiddenproductId<%=i%>">
                              <%}else{%>
                                <a>
                                  <button type="button" class="applyoffer" onclick="showofferModal('<%=i%>')">
                                    APPLY</button></a>
                                <input type="hidden" value='<%= item._id %>' id="hiddenproductId<%=i%>">
                                <%}%>
                        </b>
                      </td>
                      <td class="product-actions">
                        <div class="btn-group" role="group" aria-label="Product Actions">
                          <button class="btn <%= item.isBlocked ? 'btn-danger' : 'btn-success' %>"
                            data-id="<%= item._id %>" onclick="confirmShow(this)" id="<%= item._id %>">
                            <%= item.isBlocked===1 ? 'Unlist' : 'List' %>
                          </button>
                          &nbsp;&nbsp;
                          <a href="/admin/editProduct/<%= item._id %> " class="btn btn-dark">
                            <i class="bi bi-pencil"></i> Edit</a>
                        </div>
                      </td>
                    </tr>
                    <% })} else { %>
                      <tr>
                        <td colspan="5" class="text-center no-data">No products found</td>
                      </tr>
                      <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Pagination -->
<div class="col-md-12 text-center">
  <div class="site-block-27">
      <ul>
          <!-- Previous Button -->
          <% if (currentPage > 1) { %>
              <li>
                  <a href="?page=<%= currentPage - 1 %>">Previous</a>
              </li>
          <% } %>

          <!-- Current Page -->
          <li class="active">
              <span><%= currentPage %></span>
          </li>

          <!-- Next Button -->
          <% if (currentPage < totalPages) { %>
              <li>
                  <a href="?page=<%= parseInt(currentPage) + 1 %>">Next</a>
              </li>
          <% } %>
      </ul>
  </div>
</div>





      <!-- Confirm Modal -->
      <div class="modal fade" id="confirm-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Are you sure?</h1>

              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <p class="error-modal"></p>
              <p>Do you really want to <strong id="action-text">block</strong> this product?</p>
              <input type="hidden" name="id" id="action-id" value="" />
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Cancel
              </button>
              <button type="button" class="btn btn-primary" onclick="productList()" id="action-btn">
                Block
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- modal for apply offer -->
      <!-- Modal -->
      <section>
        <div class="modal fade" id="offerconfirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel"
          aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirmation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <% if (offer.length> 0) { %>
                  <div class="row " style="justify-content: space-between;">
                    <% for (let i=0; i < offer.length; i++) { %>
                      <div class="col-md-6 mb-4 p-0 ">
                        <div class="card m-3">
                          <div class="card-body">
                            <h5 class="card-title">
                              <%= offer[i].name %>
                            </h5>
                            <p class="card-text">Discount: <%= offer[i].discountAmount %>%
                            </p>
                            <p class="card-text">Activation Date: <%=
                                offer[i].activationDate.toLocaleDateString('en-US', { year:'numeric', month: 'short' ,
                                day: '2-digit' }).replace(/\//g, '-' ) %>
                            </p>
                            <p class="card-text">Expiry Date: <%= offer[i].expiryDate.toLocaleDateString('en-US', {
                                year:'numeric', month: 'short' , day: '2-digit' }).replace(/\//g, '-' ) %>
                            </p>

                            <button class="btn Edit-category" onclick="offerapply('<%= offer[i]._id %>')">Apply</button>
                          </div>
                        </div>
                      </div>
                      <% } %>
                  </div>
                  <% } else { %>
                    <p class="text-center">No offers available</p>
                    <% } %>
              </div>
      </section>

      <style>
        .modal-backdrop {
          position: relative;
        }

        .image-container {
          width: 100px;
          /* Set the desired width */
          height: 100px;
          /* Set the desired height */
          overflow: hidden;
          border-radius: 5px;
        }

        .image-container img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
      </style>

      <script type="text/javascript" src="/public/adminAssets/js/main.min.js?v=1628755089081"></script>

      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
      <script type="text/javascript" src="/public/adminAssets/js/chart.sample.min.js"></script>

      <script type="text/javascript" src="/public/adminAssets/js/main.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

      <noscript><img height="1" width="1" style="display:none"
          src="https://www.facebook.com/tr?id=658339141622648&ev=PageView&noscript=1" /></noscript>

      <!-- Icons below are for demo only. Feel free to use any icon pack. Docs: https://bulma.io/documentation/elements/icon/ -->
      <link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.9.95/css/materialdesignicons.min.css">


      <script>
        let index;
        function showofferModal(i) {
          console.log("iiiii:", i);
          index = i;
          $('#offerconfirmationModal').modal('show');
        }

        function offerapply(offerId) {
          console.log("offerId :", offerId);
          const productId = document.getElementById(`hiddenproductId${index}`).value;
          console.log("produc id :", productId);

          fetch("/admin/applyOffer", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ offerId, productId })
          })
            .then((response) => response.json())
            .then(data => {
              console.log("dataatatatataatata apply offer:", data);
              if (data.success == true) {
                Swal.fire({
                  titel: "Success",
                  text: "offer added successfully!",
                  icon: "success",
                  confirmButtonText: "OK"
                })
                .then(()=>{
                  document.location.reload()
                })
               
              }

            })
            .catch(error => {
              console.log("error on apply offer:", error);
            })
        }


        function removeoffer(x) {
          const productId = document.getElementById(`hiddenproductId${x}`).value;
          console.log("product id of remove :", productId);
          fetch("/admin/removeOffer", {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ productId })
          })
            .then((response) => response.json())
            .then(data => {
              if (data.success == true) {
                Swal.fire({
                  titel: "Success",
                  text: "offer removed successfully!",
                  icon: "success",
                  confirmButtonText: "OK",
                })
                .then(()=>{
                  document.location.reload();
                })
                
              }

            })
            .catch(error => {
              console.log("erorro on remove offer :", error);
            })
        }

        
      </script>

      <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

</body>

</html>